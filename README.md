# VZip - è§†é¢‘æ‰¹é‡å‹ç¼©å·¥å…·

ğŸ¬ ä¸€ä¸ªåŸºäº FFmpeg çš„è½»é‡çº§è§†é¢‘æ‰¹é‡å‹ç¼©å‘½ä»¤è¡Œå·¥å…·ï¼Œæ”¯æŒ MP4 è§†é¢‘æ–‡ä»¶çš„é«˜æ•ˆå‹ç¼©ã€‚

## ç‰¹æ€§

- ğŸš€ **æ‰¹é‡å¤„ç†**: ä¸€æ¬¡æ€§å‹ç¼©ç›®å½•ä¸‹æ‰€æœ‰ MP4 è§†é¢‘æ–‡ä»¶
- ğŸ¯ **è´¨é‡æ§åˆ¶**: æ”¯æŒé«˜ã€ä¸­ã€ä½ä¸‰ç§è´¨é‡æ¡£ä½
- ğŸ§  **æ™ºèƒ½å‹ç¼©**: æ”¯æŒç›®æ ‡æ–‡ä»¶å¤§å°ï¼Œè‡ªåŠ¨è°ƒæ•´å‚æ•°ç›´åˆ°è¾¾åˆ°ç›®æ ‡
- âš¡ **çµæ´»å¸§ç‡**: æ”¯æŒè‡ªå®šä¹‰å¸§ç‡è®¾ç½®
- ğŸ“± **å¿«é€Ÿå¯åŠ¨**: æ”¯æŒ faststart é€‰é¡¹ï¼Œä¼˜åŒ–ç½‘ç»œæ’­æ”¾
- ğŸ“Š **å®æ—¶åé¦ˆ**: æ˜¾ç¤ºå‹ç¼©åçš„æ–‡ä»¶å¤§å°ä¿¡æ¯
- ğŸ¨ **å‹å¥½è¾“å‡º**: å½©è‰²å‘½ä»¤è¡Œè¾“å‡ºï¼Œå®æ—¶æ˜¾ç¤ºå¤„ç†è¿›åº¦
- ğŸ’ª **ç¨³å®šå¯é **: åŸºäº FFmpeg-staticï¼Œæ— éœ€å•ç‹¬å®‰è£… FFmpeg

## å®‰è£…

```bash
# å…¨å±€å®‰è£…ï¼ˆæ¨èï¼‰
npm install -g vzip

# æˆ–è€…æœ¬åœ°å®‰è£…
npm install vzip
```

### åŒ…ç®¡ç†å™¨å…¼å®¹æ€§

âš ï¸ **é‡è¦æç¤º**: å»ºè®®ä½¿ç”¨ **npm** å®‰è£…ï¼Œä¸æ¨èä½¿ç”¨ pnpmã€‚

- âœ… **æ¨è**: `npm install -g vzip`
- âŒ **ä¸æ¨è**: `pnpm add -g vzip` (å¯èƒ½å¯¼è‡´ FFmpeg è·¯å¾„é—®é¢˜)

å¦‚æœæ‚¨å·²ç»ç”¨ pnpm å®‰è£…äº†ï¼Œè¯·å…ˆå¸è½½å†ç”¨ npm é‡æ–°å®‰è£…ï¼š

```bash
pnpm remove -g vzip
npm install -g vzip
```

## ä½¿ç”¨æ–¹æ³•

```bash
vzip <directory> [options]
```

### å‚æ•°è¯´æ˜

- `<directory>`: **å¿…éœ€** - åŒ…å«è¦å‹ç¼©çš„è§†é¢‘æ–‡ä»¶çš„ç›®å½•è·¯å¾„
- `--fps <fps>`: è®¾ç½®å¸§ç‡ï¼ˆé»˜è®¤ 30fpsï¼‰
- `--quality <level>`: è®¾ç½®è§†é¢‘è´¨é‡ç­‰çº§ï¼ˆå¯é€‰å€¼ï¼šhigh, medium, lowï¼Œé»˜è®¤ mediumï¼‰
- `--target-size-mb <size>`: è®¾ç½®ç›®æ ‡æ–‡ä»¶å¤§å°ï¼ˆMBï¼‰ï¼Œå·¥å…·ä¼šè‡ªåŠ¨è°ƒæ•´å‚æ•°ç›´åˆ°è¾¾åˆ°ç›®æ ‡
- `--clear-temp`: åœ¨ä½¿ç”¨ç›®æ ‡å¤§å°å‹ç¼©æ—¶æ¸…ç†ä¸­é—´ä¸´æ—¶æ–‡ä»¶ï¼ˆé»˜è®¤å…³é—­ï¼‰
- `--faststart`: å¯ç”¨ faststartï¼Œå°† moov åŸå­ç§»åˆ°æ–‡ä»¶å¼€å¤´ä»¥ä¼˜åŒ–ç½‘ç»œæ’­æ”¾

### ä½¿ç”¨ç¤ºä¾‹

```bash
# åŸºæœ¬ç”¨æ³•ï¼šå‹ç¼©æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰ MP4 æ–‡ä»¶
vzip ./videos

# ä½¿ç”¨é«˜è´¨é‡å‹ç¼©
vzip ./videos --quality high

# è®¾ç½®ç›®æ ‡æ–‡ä»¶å¤§å°ä¸º 10MBï¼ˆæ™ºèƒ½å‹ç¼©ï¼‰
vzip ./videos --target-size-mb 10

# è®¾ç½®è‡ªå®šä¹‰å¸§ç‡
vzip ./videos --fps 24

# å¯ç”¨ faststart ä¼˜åŒ–
vzip ./videos --faststart

# ç»„åˆä½¿ç”¨å¤šä¸ªé€‰é¡¹
vzip ./videos --quality high --fps 30 --faststart

# æ™ºèƒ½å‹ç¼©åˆ°æŒ‡å®šå¤§å°ï¼Œå¹¶ä¼˜åŒ–æ’­æ”¾
vzip ./videos --target-size-mb 5 --faststart

# æ™ºèƒ½å‹ç¼© + è‡ªåŠ¨æ¸…ç†ä¸­é—´æ–‡ä»¶
vzip ./videos --target-size-mb 8 --clear-temp
```

## è´¨é‡è®¾ç½®è¯¦è§£

| è´¨é‡ç­‰çº§ | CRF å€¼ | æè¿°                     | é€‚ç”¨åœºæ™¯                 |
| -------- | ------ | ------------------------ | ------------------------ |
| `high`   | 18     | é«˜è´¨é‡ï¼Œæ–‡ä»¶è¾ƒå¤§         | ä¸“ä¸šç”¨é€”ï¼Œè´¨é‡è¦æ±‚é«˜     |
| `medium` | 23     | ä¸­ç­‰è´¨é‡ï¼Œå¹³è¡¡å¤§å°å’Œè´¨é‡ | æ—¥å¸¸ä½¿ç”¨ï¼Œæ¨èè®¾ç½®       |
| `low`    | 28     | ä½è´¨é‡ï¼Œæ–‡ä»¶è¾ƒå°         | å¿«é€Ÿåˆ†äº«ï¼Œå¯¹è´¨é‡è¦æ±‚ä¸é«˜ |

## æ™ºèƒ½å‹ç¼©åŠŸèƒ½

å½“ä½¿ç”¨ `--target-size-mb` å‚æ•°æ—¶ï¼Œå·¥å…·ä¼šè‡ªåŠ¨è°ƒæ•´å‹ç¼©å‚æ•°ç›´åˆ°è¾¾åˆ°ç›®æ ‡æ–‡ä»¶å¤§å°ï¼š

1. **åˆå§‹å‹ç¼©**: ä½¿ç”¨é»˜è®¤å‚æ•°è¿›è¡Œç¬¬ä¸€æ¬¡å‹ç¼©
2. **å¤§å°æ£€æŸ¥**: æ£€æŸ¥å‹ç¼©åçš„æ–‡ä»¶å¤§å°
3. **å‚æ•°è°ƒæ•´**: å¦‚æœæœªè¾¾åˆ°ç›®æ ‡ï¼Œè‡ªåŠ¨è°ƒæ•´ CRFã€ç ç‡ã€é¢„è®¾ç­‰å‚æ•°
4. **é€’å½’å‹ç¼©**: é‡å¤å‹ç¼©ç›´åˆ°è¾¾åˆ°ç›®æ ‡å¤§å°
5. **ä¸´æ—¶æ–‡ä»¶æ¸…ç†** (å¯é€‰): ä½¿ç”¨ `--clear-temp` è‡ªåŠ¨æ¸…ç†ä¸­é—´äº§ç”Ÿçš„æ–‡ä»¶

### è°ƒæ•´ç­–ç•¥

- **CRF å¢åŠ **: é€æ­¥æé«˜ CRF å€¼ï¼Œå¢å¼ºå‹ç¼©ç‡
- **ç ç‡é™ä½**: å½“ CRF > 28 æ—¶ï¼Œé™ä½è§†é¢‘ç ç‡
- **å¸§ç‡è°ƒæ•´**: å½“ CRF > 30 æ—¶ï¼Œå°†å¸§ç‡é™ä½åˆ° 24fps
- **æè‡´å‹ç¼©**: å½“ CRF > 32 æ—¶ï¼Œä½¿ç”¨æœ€ä½ç ç‡ 500k

## è¾“å‡ºè¯´æ˜

å‹ç¼©åçš„æ–‡ä»¶å°†ä¿å­˜åœ¨åŸç›®å½•ä¸­ï¼Œæ–‡ä»¶åæ ¼å¼ä¸ºï¼š`åŸæ–‡ä»¶å-compressed.mp4`

ä¾‹å¦‚ï¼š`video.mp4` â†’ `video-compressed.mp4`

## æŠ€æœ¯ç»†èŠ‚

- **è§†é¢‘ç¼–ç **: H.264 (libx264)
- **éŸ³é¢‘ç¼–ç **: AACï¼Œ128k æ¯”ç‰¹ç‡
- **é¢„è®¾**: slow / veryslowï¼ˆæ ¹æ®æƒ…å†µè‡ªåŠ¨è°ƒæ•´ï¼‰
- **ç ç‡æ§åˆ¶**: æ”¯æŒè‡ªé€‚åº”è°ƒæ•´ï¼ˆ500k-3000kï¼‰
- **CRF èŒƒå›´**: 23-32+ï¼ˆæ™ºèƒ½è°ƒæ•´ï¼‰
- **åŸºäº**: FFmpeg-static

## ç³»ç»Ÿè¦æ±‚

- Node.js >= 14.0.0
- æ”¯æŒ Windowsã€macOSã€Linux

## ä¾èµ–é¡¹

- [ffmpeg-static](https://www.npmjs.com/package/ffmpeg-static) - é™æ€ FFmpeg äºŒè¿›åˆ¶æ–‡ä»¶
- [commander](https://www.npmjs.com/package/commander) - å‘½ä»¤è¡Œæ¥å£æ¡†æ¶
- [chalk](https://www.npmjs.com/package/chalk) - ç»ˆç«¯å½©è‰²è¾“å‡º

## ç¤ºä¾‹è¾“å‡º

### åŸºæœ¬å‹ç¼©

```bash
$ vzip ./my-videos --faststart

Found 3 video(s) to compress.
Compressing: video1.mp4...
Compressed: ./my-videos/video1-compressed.mp4 - Size: 15.23 MB
Successfully compressed: video1.mp4
Compressing: video2.mp4...
Compressed: ./my-videos/video2-compressed.mp4 - Size: 8.76 MB
Successfully compressed: video2.mp4
Compressing: video3.mp4...
Compressed: ./my-videos/video3-compressed.mp4 - Size: 12.45 MB
Successfully compressed: video3.mp4
```

### æ™ºèƒ½å‹ç¼©ç¤ºä¾‹

```bash
$ vzip ./my-videos --target-size-mb 6 --clear-temp

Found 1 video(s) to compress.
Compressing: large-video.mp4...
Compressed: ./my-videos/large-video-compressed.mp4 - Size: 25.34 MB
Target size not reached! Current size: 25.34 MB
Recompressing: large-video-compressed.mp4...
Compressed: ./my-videos/large-video-compressed-compressed.mp4 - Size: 8.67 MB
Target size not reached! Current size: 8.67 MB
Recompressing: large-video-compressed-compressed.mp4...
Compressed: ./my-videos/large-video-compressed-compressed-compressed.mp4 - Size: 5.45 MB
Cleaning up temporary files...
Deleted: large-video-compressed.mp4
Deleted: large-video-compressed-compressed.mp4
Temporary files cleaned up!
Successfully compressed: large-video.mp4
```

## æ³¨æ„äº‹é¡¹

- ç›®å‰ä»…æ”¯æŒ MP4 æ ¼å¼çš„è¾“å…¥æ–‡ä»¶
- å‹ç¼©è¿‡ç¨‹ä¸­è¯·å‹¿ç§»åŠ¨æˆ–åˆ é™¤åŸæ–‡ä»¶
- å¤§æ–‡ä»¶å‹ç¼©å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼Œè¯·è€å¿ƒç­‰å¾…
- æ™ºèƒ½å‹ç¼©å¯èƒ½éœ€è¦å¤šæ¬¡è¿­ä»£ï¼Œè¯·ç¡®ä¿æœ‰è¶³å¤Ÿçš„ç¡¬ç›˜ç©ºé—´
- ç›®æ ‡æ–‡ä»¶å¤§å°è®¾ç½®å¾—å¤ªå°å¯èƒ½å½±å“è§†é¢‘è´¨é‡
- ä¸å»ºè®®ä½¿ç”¨ pnpm å®‰è£…ï¼Œå¯èƒ½å¯¼è‡´ FFmpeg è·¯å¾„é—®é¢˜

## å¸¸è§é—®é¢˜

**Q: ä¸ºä»€ä¹ˆæ²¡æœ‰æ‰¾åˆ°è§†é¢‘æ–‡ä»¶ï¼Ÿ**
A: è¯·ç¡®ä¿ç›®å½•ä¸­åŒ…å« `.mp4` æ ¼å¼çš„æ–‡ä»¶ï¼Œä¸”æ–‡ä»¶æ‰©å±•åä¸ºå°å†™ã€‚

**Q: å‹ç¼©åæ–‡ä»¶å˜å¤§äº†ï¼Ÿ**
A: å¯¹äºå·²ç»é«˜åº¦å‹ç¼©çš„è§†é¢‘ï¼Œå†æ¬¡å‹ç¼©å¯èƒ½ä¼šå¢åŠ æ–‡ä»¶å¤§å°ã€‚å»ºè®®å…ˆæµ‹è¯•ä¸€ä¸ªæ–‡ä»¶ã€‚

**Q: æ”¯æŒå…¶ä»–è§†é¢‘æ ¼å¼å—ï¼Ÿ**
A: ç›®å‰ä»…æ”¯æŒ MP4 æ ¼å¼ï¼Œåç»­ç‰ˆæœ¬å°†æ·»åŠ æ›´å¤šæ ¼å¼æ”¯æŒã€‚

**Q: æ™ºèƒ½å‹ç¼©éœ€è¦å¤šé•¿æ—¶é—´ï¼Ÿ**
A: å–å†³äºç›®æ ‡å¤§å°å’ŒåŸå§‹æ–‡ä»¶å¤§å°ï¼Œå¯èƒ½éœ€è¦å¤šæ¬¡è¿­ä»£å‹ç¼©ï¼Œè¯·è€å¿ƒç­‰å¾…ã€‚

**Q: ä¸ºä»€ä¹ˆæ— æ³•è¾¾åˆ°ç›®æ ‡æ–‡ä»¶å¤§å°ï¼Ÿ**
A: æå°çš„ç›®æ ‡å¤§å°å¯èƒ½æ— æ³•å®ç°ï¼Œå·¥å…·ä¼šå°½åŠ›å‹ç¼©ä½†ä¸ä¿è¯ä¸€å®šèƒ½è¾¾åˆ°ã€‚

**Q: pnpm å®‰è£…åæŠ¥é”™ "No such file or directory"ï¼Ÿ**
A: è¿™æ˜¯ pnpm ä¸ FFmpeg çš„å…¼å®¹æ€§é—®é¢˜ã€‚è¯·ä½¿ç”¨ npm å®‰è£…ï¼š`pnpm remove -g vzip && npm install -g vzip`

## è®¸å¯è¯

ISC

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

---

å¦‚æœè¿™ä¸ªå·¥å…·å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ª â­ Starï¼
